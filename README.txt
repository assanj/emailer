# Emailer - Программа для автоматической отправки email уведомлений
# Версия 1.0

Emailer - специализированное приложение для автоматической отправки 
email уведомлений со скрытым интерфейсом. Программа предназначена для 
использования в системах мониторинга, автоматизированных задачах и сценариях, 
где требуется уведомление о событиях без вмешательства пользователя.

Основное назначение:
- Мониторинг состояния рабочих станций
- Уведомления о запуске/завершении задач
- Отчеты о автоматизированных процессах
- Интеграция с системами управления IT-инфраструктурой

📧 Email функциональность:
- Поддержка SMTP с аутентификацией
- SSL/TLS шифрование соединения
- Автоматическое кодирование UTF-8 для поддержки кириллицы
- Настраиваемые темы и содержимое писем

🖥️ Системная интеграция:
- Автоматическое скрытие консольного окна
- Сбор системной информации (имя компьютера, пользователь, домен)
- Интеграция с реестром Windows для хранения настроек
- Работа в фоновом режиме

⚙️ Гибкая конфигурация:
- Хранение настроек в реестре Windows
- Внешний файл конфигурации для темы письма
- Автоматическое создание настроек по умолчанию
- Подробное логирование операций

🔒 Надежность:
- Обработка исключений на всех уровнях
- Детальное логирование ошибок
- Автовосстановление при повреждении настроек

АРХИТЕКТУРА И ПРИНЦИП РАБОТЫ

Компоненты системы:

Emailer.exe
    │
    ├── Модуль конфигурации
    │   ├── Чтение реестра Windows
    │   ├── Управление файлом emailer.ini
    │   └── Создание настроек по умолчанию
    │
    ├── Модуль сбора системной информации
    │   ├── Имя компьютера
    │   ├── Текущий пользователь
    │   ├── Доменная информация
    │   └── Временные метки
    │
    ├── SMTP клиент
    │   ├── Установка соединения
    │   ├── Аутентификация
    │   └── Отправка сообщений
    │
    └── Система логирования
        ├── Лог успешных операций
        └── Лог ошибок

Последовательность работы:
1. Запуск приложения и скрытие окна
2. Загрузка конфигурации из реестра
3. Чтение темы из файла emailer.ini
4. Сбор системной информации
5. Установка SMTP соединения
6. Формирование и отправка письма
7. Логирование результата операции
8. Завершение работы приложения

ПОДРОБНАЯ ИНСТРУКЦИЯ ПО УСТАНОВКЕ

Предварительные требования:
- Операционная система Windows 7/8/10/11 или Windows Server 2008+
- Установленный .NET Framework 4.0 или выше
- Права администратора для установки в систему
- Доступ к интернету для отправки email
- Разрешение на исходящие соединения на порт SMTP (обычно 587)

Шаги установки:

Шаг 1: Проверка .NET Framework
Откройте командную строку и выполните:
reg query "HKLM\Software\Microsoft\NET Framework Setup\NDP\v4\Full" /v Release

Если команда возвращает ошибку, установите .NET Framework 4.8

Шаг 2: Размещение программы
Скопируйте файл Emailer.exe в постоянную директорию, например:
C:\Program Files\Emailer\Emailer.exe

Шаг 3: Первоначальная настройка
Запустите программу один раз для создания настроек по умолчанию

Шаг 4: Проверка создания файлов
Убедитесь, что созданы файлы:
- emailer.ini - файл темы письма
- emailer.log - лог операций

КОНФИГУРАЦИЯ И НАСТРОЙКА

Настройки в реестре Windows:

Программа хранит настройки по пути:
HKEY_CURRENT_USER\Software\Emailer

Параметры реестра:

Параметр    | По умолчанию          | Описание
-----------|----------------------|----------
Secret     | yoursecret           | Пароль для SMTP аутентификации
Username   | DOMAIN\user          | Имя пользователя
SmtpServer | mail.domain.ru       | Адрес SMTP сервера
SmtpPort   | 587                  | Порт SMTP сервера
FromEmail  | account@domain.ru    | Email отправителя
ToEmail    | account@domain.ru    | Email получателя

Редактирование настроек через reg-файл:

Создайте файл EmailerSettings.reg:

Windows Registry Editor Version 5.00

[HKEY_CURRENT_USER\Software\Emailer]
"Secret"="ваш_действительный_пароль"
"Username"="ВАШДОМЕН\\пользователь"
"SmtpServer"="smtp.yourcompany.com"
"SmtpPort"="587"
"FromEmail"="notify@yourcompany.com"
"ToEmail"="admin@yourcompany.com"

Настройка темы письма:

Файл emailer.ini содержит тему письма. По умолчанию: "Subject_demo"

Примеры тем:
Мониторинг рабочей станции
Отчет о выполнении задачи
Системное уведомление
Аварийное оповещение

Настройка для популярных почтовых сервисов:

Gmail/Google Workspace:
SmtpServer: smtp.gmail.com
SmtpPort: 587
Username: your.email@gmail.com
Secret: пароль приложения

Yandex Mail:
SmtpServer: smtp.yandex.ru
SmtpPort: 587
Username: ваш_логин
Secret: пароль приложения

Mail.ru:
SmtpServer: smtp.mail.ru
SmtpPort: 587
Username: полный email
Secret: пароль приложения

Office 365:
SmtpServer: smtp.office365.com
SmtpPort: 587
Username: ваш_email@company.com
Secret: ваш_пароль

ИСПОЛЬЗОВАНИЕ И ЭКСПЛУАТАЦИЯ

Базовое использование:

Просто запустите исполняемый файл:
Emailer.exe

Программа выполнит отправку письма и автоматически завершит работу.

Интеграция с планировщиком задач:

Создание задачи в Планировщике заданий Windows:

1. Откройте Планировщик заданий (taskschd.msc)
2. Создайте простую задачу
3. Настройте триггер (расписание)
4. В действии укажите программу Emailer.exe

Пример для ежедневного отчета в 9:00:
Имя задачи: Daily Email Report
Триггер: Ежедневно в 09:00
Действие: Запуск программы "C:\Program Files\Emailer\Emailer.exe"

Интеграция с системами мониторинга:

Программа может запускаться из:
- Скриптов PowerShell
- Пакетных файлов (.bat)
- Систем типа Zabbix, Nagios
- Jenkins и других CI/CD систем

Пример PowerShell скрипта:

try {
    & "C:\Program Files\Emailer\Emailer.exe"
    Write-Host "Email отправлен успешно"
} catch {
    Write-Error "Ошибка отправки email: $_"
}

ЛОГИРОВАНИЕ И МОНИТОРИНГ

Файлы логов:

Программа создает два лог-файла в директории с исполняемым файлом:

emailer.log - лог успешных операций
2024-01-15 14:30:25 - Созданы настройки по умолчанию в реестре
2024-01-15 14:31:10 - Письмо отправлено: Мониторинг системы
2024-01-15 15:00:01 - Письмо отправлено: Ежедневный отчет

emailer_error.log - лог ошибок
2024-01-15 14:29:33 - Ошибка отправки: The SMTP server requires a secure connection...
2024-01-15 14:30:15 - Пароль не настроен в реестре

Мониторинг работы:

PowerShell скрипт для проверки логов:

function Get-EmailerStatus {
    $logPath = "C:\Program Files\Emailer\emailer.log"
    $errorLogPath = "C:\Program Files\Emailer\emailer_error.log"
    
    if (Test-Path $logPath) {
        Write-Host "Последние успешные отправки:"
        Get-Content $logPath | Select-Object -Last 5
    }
    
    if (Test-Path $errorLogPath) {
        Write-Host "Последние ошибки:"
        Get-Content $errorLogPath | Select-Object -Last 5
    }
}

УСТРАНЕНИЕ НЕИСПРАВНОСТЕЙ

Распространенные проблемы и решения:

Проблема: "Пароль не настроен в реестре"
Решение: Настройте параметр Secret в реестре

Проблема: "The SMTP server requires a secure connection"
Решение: Убедитесь, что EnableSsl = True и порт правильный

Проблема: "Failure sending mail"
Решение: Проверьте настройки SMTP сервера и учетные данные

Проблема: Таймаут соединения
Решение: Проверьте доступность SMTP сервера и брандмауэр

Диагностические команды:

Проверка связи с SMTP сервером:
telnet smtp.server.com 587

Проверка настроек реестра:
reg query "HKEY_CURRENT_USER\Software\Emailer"

Проверка файла темы:
Get-Content "emailer.ini"

БЕЗОПАСНОСТЬ

Рекомендации по безопасности:

1. Хранение паролей:
   - Пароль хранится в реестре в открытом виде
   - Используйте отдельную учетную запись для отправки почты
   - Регулярно меняйте пароли

2. Доступ к реестру:
   - Ограничьте доступ к разделу HKEY_CURRENT_USER\Software\Emailer
   - Используйте права доступа для защиты конфиденциальных данных

3. Сетевые настройки:
   - Используйте SSL/TLS шифрование
   - Ограничьте исходящий трафик на порт SMTP
   - Используйте VPN для дополнительной безопасности

ТЕХНИЧЕСКИЕ ТРЕБОВАНИЯ

Минимальные требования:
- ОС: Windows 7 SP1 / Windows Server 2008 R2 SP1
- .NET Framework: 4.0
- Память: 512 MB RAM
- Процессор: 1 GHz
- Дисковое пространство: 10 MB

Рекомендуемые требования:
- ОС: Windows 10 / Windows Server 2016+
- .NET Framework: 4.8
- Память: 1 GB RAM
- Процессор: 2 GHz
- Дисковое пространство: 50 MB

Поддерживаемые архитектуры:
- x86 (32-бит)
- x64 (64-бит)
- AnyCPU

ЧАСТО ЗАДАВАЕМЫЕ ВОПРОСЫ

В: Программа не отправляет письма, что делать?
О: Проверьте логи ошибок, настройки SMTP и доступ в интернет

В: Как изменить тему письма?
О: Отредактируйте файл emailer.ini или используйте параметры командной строки

В: Можно ли отправлять письма нескольким получателям?
О: В текущей версии поддерживается только один получатель

В: Как проверить, что программа работает?
О: Запустите программу и проверьте файлы emailer.log и emailer_error.log

В: Поддерживается ли аутентификация без пароля?
О: Нет, требуется аутентификация по логину и паролю

В: Можно ли использовать программу в доменной среде?
О: Да, программа поддерживает доменную аутентификацию

ПАРАМЕТРИЗАЦИЯ И ЗАПУСК ИЗ ПЛАНИРОВЩИКА ЗАДАЧ

Параметры командной строки:

Программа поддерживает следующие параметры запуска:

/subject или /s - указание темы письма
Emailer.exe /subject "Ежедневный отчет системы"
Emailer.exe /s "Мониторинг рабочей станции"

/debug - режим отладки (показывает консольное окно)
Emailer.exe /debug
Emailer.exe /subject "Тестовое сообщение" /debug

Примеры использования в планировщике задач:

Базовый запуск с темой:
Программа: C:\Program Files\Emailer\Emailer.exe
Аргументы: /subject "Ежедневный отчет"

Запуск с несколькими параметрами:
Программа: C:\Program Files\Emailer\Emailer.exe
Аргументы: /subject "Ночной бэкап" /debug


Приоритет определения темы письма:

1. Командная строка (наивысший приоритет) - параметры /subject или /s
2. Файл emailer.ini - если параметры не указаны
3. Значение по умолчанию - "Subject_demo" (низший приоритет)

Рекомендации для планировщика задач:

1. Рабочая папка: Укажите путь к директории с программой
2. Права: Запуск с правами пользователя, имеющего доступ к SMTP
3. Триггеры: Настройте соответствующие расписания для разных типов уведомлений
4. Аргументы: Используйте параметр /subject для понятных названий задач

